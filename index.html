<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сайтецкий простой</title>
    <link rel="stylesheet" href="normalize.css">
    <!-- Предварительная загрузка шрифта -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" as="style" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">

    <style>
        /* Общие стили */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Fira Sans', sans-serif;
            overflow-x: hidden;
        }

        .section {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            display: none; /* Скрываем контент до полной загрузки */
            padding: 20px;
            box-sizing: border-box;
        }

        .first-screen {
            background: #f0f0f0;
        }

        .first-screen h1 {
            font-weight: 700;
        }

        .second-screen {
            background: #fff;
        }

        /* Кнопка */
        .first-screen button {
            position: relative;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
            width: 100%;
            max-width: 450px;
            height: 60px;
            border: none;
            border-radius: 15px;
            background-color: #007bff;
            color: #fff;
            font-size: 18px;
            transition: background-color 0.5s;
            cursor: pointer;
        }

        .first-screen button svg {
            width: 30px;
            height: 30px;
            fill: #fff;
        }

        .first-screen button:hover {
            background-color: #2c90fa;
        }

        /* Прелоадер */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s;
            font-family: 'Fira Sans', sans-serif; /* Применяем шрифт сразу */
        }

        .loader {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .loader svg {
            width: 100%;
            height: 100%;
        }

        .loader circle {
            fill: none;
            stroke-width: 4;
        }

        .loader .border {
            stroke: #f3f3f3;
        }

        .loader .fill {
            stroke: #007bff;
            stroke-dasharray: 283; /* Длина окружности для радиуса 45 (2 * π * r) */
            stroke-dashoffset: 283; /* Начальное значение - круг пустой */
            transition: stroke-dashoffset 0.1s linear;
        }

        .percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-family: 'Fira Sans', sans-serif; /* Применяем шрифт сразу */
        }

        /* Текст приветствия в прелоадере */
        .greeting {
            position: absolute;
            font-size: 32px;
            font-family: 'Fira Sans', sans-serif; /* Применяем шрифт сразу */
            color: #333;
            display: flex;
            justify-content: space-between;
            width: 70%;
            max-width: 800px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .greeting-left {
            transform: translateX(-200%);
            animation: slideInLeft 2s forwards;
        }

        .greeting-right {
            transform: translateX(200%);
            animation: slideInRight 2s forwards;
        }

        @keyframes slideInLeft {
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            to {
                transform: translateX(0);
            }
        }

        /* Видео */
        video {
            width: 100%;
            max-width: 1200px;
            max-height: 80vh;
        }

        /* Медиа-запросы для адаптивности */
        @media (max-width: 767px) {
            .loader {
                width: 80px;
                height: 80px;
            }

            .percentage {
                font-size: 20px;
            }

            .greeting {
                font-size: 18px;
                padding: 0 10px;
                flex-direction: column;
                top: 35%;
                width: 90%;
            }

            .greeting-left, .greeting-right {
                text-align: center;
                margin: 5px 0;
            }

            .first-screen h1 {
                font-size: 24px;
            }

            .first-screen p {
                font-size: 14px;
            }

            .first-screen button {
                max-width: 300px;
                height: 50px;
                font-size: 16px;
            }

            .first-screen button svg {
                width: 25px;
                height: 25px;
            }

            video {
                max-height: 60vh;
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .loader {
                width: 90px;
                height: 90px;
            }

            .percentage {
                font-size: 22px;
            }

            .greeting {
                font-size: 24px;
                width: 80%;
            }

            .first-screen h1 {
                font-size: 32px;
            }

            .first-screen p {
                font-size: 16px;
            }

            .first-screen button {
                max-width: 400px;
                height: 55px;
                font-size: 17px;
            }

            .first-screen button svg {
                width: 28px;
                height: 28px;
            }

            video {
                max-height: 70vh;
            }
        }

        @media (min-width: 1024px) {
            .first-screen h1 {
                font-size: 40px;
            }

            .first-screen p {
                font-size: 18px;
            }

            .first-screen button {
                max-width: 450px;
                height: 60px;
                font-size: 18px;
            }

            .first-screen button svg {
                width: 30px;
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Прелоадер -->
    <div class="preloader">
        <div class="greeting">
            <span class="greeting-left">какой-то текст</span>
            <span class="greeting-right">какой-то текст</span>
        </div>
        <div class="loader">
            <svg viewBox="0 0 100 100">
                <circle class="border" cx="50" cy="50" r="45"></circle>
                <circle class="fill" cx="50" cy="50" r="45"></circle>
            </svg>
            <div class="percentage">0%</div>
        </div>
    </div>

    <!-- Основной контент -->
    <div class="section first-screen">
        <h1>Добро пожаловать!</h1>
        <p>Какой-то текст</p>
        <button id="scrollToVideo">К Вашему вниманию, видео: 
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                <path d="M17 2.5L17 21.5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 2.5L7 21.5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 12L7 12M22 12L17 12" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2.5 7L7 7M21.5 7L17 7" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M21.5 17.75C21.9142 17.75 22.25 17.4142 22.25 17C22.25 16.5858 21.9142 16.25 21.5 16.25V17.75ZM17 16.25C16.5858 16.25 16.25 16.5858 16.25 17C16.25 17.4142 16.5858 17.75 17 17.75V16.25ZM7 17.75C7.41421 17.75 7.75 17.4142 7.75 17C7.75 16.5858 7.41421 16.25 7 16.25L7 17.75ZM17 17.75L21.5 17.75V16.25L17 16.25V17.75ZM2 17.75L7 17.75L7 16.25L2 16.25L2 17.75Z" fill="#1C274C"/>
                <path d="M14 12C14 11.4722 13.4704 11.1162 12.4112 10.4043C11.3375 9.68271 10.8006 9.3219 10.4003 9.58682C10 9.85174 10 10.5678 10 12C10 13.4322 10 14.1483 10.4003 14.4132C10.8006 14.6781 11.3375 14.3173 12.4112 13.5957C13.4704 12.8838 14 12.5278 14 12Z" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C21.352 4.28094 21.7133 5.37486 21.8731 7M22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2.64799 19.7191 2.28672 18.6251 2.12687 17" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <div class="section second-screen">
        <video controls>
            <source src="prikol.mp4" type="video/mp4">
            Ваш браузер не поддерживает видео.
        </video>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const preloader = document.querySelector('.preloader');
            const fill = document.querySelector('.fill');
            const percentageText = document.querySelector('.percentage');
            const sections = document.querySelectorAll('.section');
            const video = document.querySelector('video');
            const scrollButton = document.querySelector('#scrollToVideo');
            const secondScreen = document.querySelector('.second-screen');
            const MINIMUM_PRELOADER_TIME = 5000; // 5 секунд в миллисекундах

            // Скрываем основной контент до полной загрузки
            sections.forEach(section => section.style.display = 'none');

            // Инициализируем прогресс и время старта
            let currentProgress = 0;
            let isVideoLoaded = false;
            let isFontLoaded = false;
            let startTime = Date.now();

            // Функция обновления прогресса
            const updateProgress = (progress) => {
                currentProgress = Math.min(progress, 100);
                percentageText.textContent = `${Math.round(currentProgress)}%`;
                const dashOffset = 283 * (1 - currentProgress / 100); // 283 - длина окружности
                fill.style.strokeDashoffset = dashOffset;
            };

            // Проверка полной загрузки всех ресурсов с минимальной задержкой
            const checkAllLoaded = () => {
                if (isVideoLoaded && isFontLoaded && currentProgress >= 100) {
                    const elapsedTime = Date.now() - startTime;
                    const remainingTime = Math.max(0, MINIMUM_PRELOADER_TIME - elapsedTime);

                    setTimeout(() => {
                        preloader.style.opacity = '0';
                        sections.forEach(section => section.style.display = 'flex');
                        setTimeout(() => {
                            preloader.style.display = 'none';
                        }, 1000); // Время анимации исчезновения
                    }, remainingTime);
                }
            };

            // Имитация прогресса до загрузки видео
            const simulateProgress = () => {
                const simulation = setInterval(() => {
                    if (currentProgress < 80 && !isVideoLoaded) {
                        currentProgress += 1; // Быстрее в начале
                        updateProgress(currentProgress);
                    } else if (currentProgress < 95 && !isVideoLoaded) {
                        currentProgress += 0.5; // Замедляем ближе к 95%
                        updateProgress(currentProgress);
                    } else if (!isVideoLoaded) {
                        clearInterval(simulation); // Ждем реальной загрузки
                    }
                }, 50); // Скорость имитации
            };

            // Отслеживание загрузки шрифта
            Promise.all([
                document.fonts.load('400 1em "Fira Sans"'), // Загружаем конкретный вес шрифта
                document.fonts.load('700 1em "Fira Sans"')  // Можно добавить другие веса, если используются
            ]).then(() => {
                isFontLoaded = true;
                console.log('Шрифты загружены');
                checkAllLoaded();
            }).catch((error) => {
                console.error('Ошибка загрузки шрифта:', error);
                isFontLoaded = true; // Продолжаем даже при ошибке
                checkAllLoaded();
            });

            // Отслеживание реальной загрузки видео через XMLHttpRequest
            const videoUrl = document.querySelector('video source').src;
            const xhr = new XMLHttpRequest();
            xhr.open('GET', videoUrl, true);
            xhr.responseType = 'blob';

            xhr.onprogress = (event) => {
                if (event.lengthComputable) {
                    const realProgress = (event.loaded / event.total) * 95; // До 95% по реальной загрузке
                    if (realProgress > currentProgress) {
                        currentProgress = realProgress;
                        updateProgress(currentProgress);
                    }
                }
            };

            xhr.onload = () => {
                isVideoLoaded = true;
                const finalAnimation = setInterval(() => {
                    if (currentProgress < 100) {
                        currentProgress += 1; // Плавно до 100%
                        updateProgress(currentProgress);
                    } else {
                        clearInterval(finalAnimation);
                        checkAllLoaded(); // Проверяем, все ли загружено
                    }
                }, 50); // Скорость финальной анимации
            };

            xhr.onerror = () => {
                console.error('Ошибка загрузки видео');
                isVideoLoaded = true;
                updateProgress(100); // Завершаем при ошибке
                checkAllLoaded();
            };

            // Начинаем загрузку видео и имитацию
            xhr.send();
            simulateProgress();

            // Плавная прокрутка до видео при нажатии на кнопку
            scrollButton.addEventListener('click', () => {
                secondScreen.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>